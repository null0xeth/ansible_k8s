---
apiVersion: kubeadm.k8s.io/v1beta3
kind: InitConfiguration
certificateKey: "68c490d7499c8f794d6a80fbb330f352db1491f2dba474906fcdd48cf9348585"
skipPhases:
  - preflight
---
apiVersion: kubeadm.k8s.io/v1beta3
kind: ClusterConfiguration
controlPlaneEndpoint: "k8s.honker.dev:6443" 
kubernetesVersion: "v1.31.2"
etcd:
  external:
    endpoints:
    {% for etcdnode in etcd_ips %}
    - https://{{ etcdnode }}:2379
    {% endfor %}

    caFile: {{ cp_sub_file_mappings['system']['kubernetes']['cluster_certs'][0] }}
    certFile: {{ cp_sub_file_mappings['system']['kubernetes']['cluster_certs'][1] }}
    keyFile: {{ cp_sub_file_mappings['system']['kubernetes']['cluster_certs'][2] }}
controllerManager:
  extraArgs:
    allocate-node-cidrs: "true"
apiServer:
  extraArgs:
    enable-aggregator-routing: "true"
    allow-privileged: "true"
    enable-bootstrap-token-auth: "true"
    advertise-address: "192.168.155.69"
    bind-address: "0.0.0.0"

networking:
  podSubnet: {{ cluster_cni[config['cni']]['pod_network'] | default('10.10.0.0/16') }}

clusterName: "honklabs"
---
apiVersion: kubelet.config.k8s.io/v1beta1
kind: KubeletConfiguration
containerRuntimeEndpoint: unix:///var/run/containerd/containerd.sock
serverTLSBootstrap: true
cgroupDriver: systemd
rotateCertificates: true
staticPodPath: /etc/kubernetes/manifests

